# Implementation Plan: Menu-Driven UI Transformation

**Branch**: `002-cli-menu-ui` | **Date**: 2025-12-28 | **Spec**: [specs/002-cli-menu-ui/spec.md](spec.md)
**Input**: Feature specification from `/specs/002-cli-menu-ui/spec.md`

**Note**: This plan was generated by the `/sp.plan` command following the specification workflow.

## Summary

Transform the CLI todo application from a command-based interface to a menu-driven UI with visual formatting and guided workflows. The implementation preserves all existing business logic (TaskManager) while replacing the command parser with a visual menu router. This Phase I transformation maintains constitutional compliance and prepares the service layer for future MCP exposure in Phase II.

**Technical Approach**:
- **Presentation Layer**: Complete UI overhaul with box-drawing characters, color coding, and guided multi-step workflows
- **Service Layer**: Unchanged - TaskManager remains decoupled and MCP-ready
- **Data Layer**: No changes - existing Task model and SQLite persistence
- **Testing**: Comprehensive coverage of new UI components while preserving existing functionality

**Key Achievement**: Zero command memorization required, 100% guided interaction, professional visual appearance.

## Technical Context

**Language/Version**: Python 3.13+ (per constitution)
**Primary Dependencies**: SQLModel, Pydantic (existing), Colorama (for ANSI colors)
**Storage**: SQLite (current), PostgreSQL-ready (future)
**Testing**: pytest (existing), 85%+ coverage target
**Target Platform**: CLI application (console-based)
**Project Type**: Single project (backend CLI)
**Performance Goals**: Sub-100ms operations, <50MB memory, <1s startup
**Constraints**: CLI-appropriate metrics, no web-scale requirements
**Scale/Scope**: Single-user focused, supports up to 5 local users, 1000+ tasks

**Constitutional Compliance**: âœ… All principles satisfied through service layer design
- Universal Logic Decoupling: TaskManager unchanged, UI separate
- AI-Native Interoperability: Service layer MCP-ready for Phase II
- Strict Statelessness: No session state, all in database
- Event-Driven Decoupling: Not applicable for CLI phase
- Zero-Trust Multi-Tenancy: Architecture supports future user_id scoping

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### âœ… Phase 0 Gate Check (PRE-RESEARCH)

**Universal Logic Decoupling**: âœ… PASS
- Business logic (TaskManager) remains completely decoupled
- UI transformation is pure presentation layer change
- No business logic modifications required

**AI-Native Interoperability**: âœ… PASS (with clarification)
- Service layer remains MCP-ready for future phases
- CLI phase is valid presentation layer enhancement
- No constitutional violation - this is Phase I of multi-phase architecture

**Strict Statelessness**: âœ… PASS
- No session state introduced
- All state persists to database
- Each operation is independent

**Event-Driven Decoupling**: âœ… PASS (not applicable)
- CLI phase doesn't require event bus
- Future phases will implement events for advanced features

**Zero-Trust Multi-Tenancy**: âœ… PASS (future-ready)
- Architecture supports user_id scoping
- Current single-user CLI is valid starting point
- Database schema prepared for multi-tenant extension

**Technology Stack**: âœ… PASS
- Python 3.13+ (compliant)
- SQLModel (compliant)
- SQLite for CLI phase (acceptable, PostgreSQL-ready)
- No unauthorized dependencies

**CONCLUSION**: âœ… **ALL GATES PASSED** - Ready for implementation

### Phase 1 Gate Check (POST-DESIGN)

Re-evaluated after design completion:
- **Data Model**: âœ… SQLModel with strict typing
- **Contracts**: âœ… Clear function interfaces
- **Architecture**: âœ… Clean separation maintained
- **Future Compatibility**: âœ… MCP-ready service layer

**CONCLUSION**: âœ… **ALL GATES PASSED** - Ready for task breakdown

## Project Structure

### Documentation (this feature)

```text
specs/002-cli-menu-ui/
â”œâ”€â”€ plan.md              # This file (/sp.plan command output)
â”œâ”€â”€ research.md          # Phase 0 output - resolves constitutional questions
â”œâ”€â”€ data-model.md        # Phase 1 output - entity definitions & validation
â”œâ”€â”€ quickstart.md        # Phase 1 output - implementation reference
â”œâ”€â”€ contracts/           # Phase 1 output - function interfaces
â”‚   â””â”€â”€ ui-contracts.md # UI function contracts & user protocols
â””â”€â”€ tasks.md             # Phase 2 output (/sp.tasks command - NEXT STEP)
```

### Source Code (repository root)

```text
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ models.py          # âœ… UNCHANGED - Task entity
â”‚   â”‚   â”œâ”€â”€ services.py        # âœ… UNCHANGED - TaskManager (MCP-ready)
â”‚   â”‚   â”œâ”€â”€ cli.py             # ðŸ”„ MODIFY - CLIHandler â†’ MenuHandler
â”‚   â”‚   â”œâ”€â”€ utils.py           # ðŸ”„ MODIFY - Add UI utilities & validation
â”‚   â”‚   â”œâ”€â”€ ui.py              # ðŸ†• NEW - All visual rendering functions
â”‚   â”‚   â”œâ”€â”€ main.py            # ðŸ”„ MODIFY - Menu loop integration
â”‚   â”‚   â””â”€â”€ exceptions.py      # âœ… UNCHANGED - Custom exceptions
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ test_menu.py       # ðŸ†• NEW - Menu routing tests (was test_cli.py)
â”‚   â”‚   â”œâ”€â”€ test_utils.py      # ðŸ†• NEW - Utility function tests
â”‚   â”‚   â”œâ”€â”€ test_ui.py         # ðŸ†• NEW - UI function tests
â”‚   â”‚   â””â”€â”€ test_services.py   # âœ… UNCHANGED - Service layer tests
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ test_menu_flow.py  # ðŸ”„ MODIFY - Complete user flow tests
â”‚   â”‚   â””â”€â”€ test_services.py   # âœ… UNCHANGED - Service integration tests
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ pyproject.toml             # âœ… UNCHANGED - Dependencies
â””â”€â”€ README.md                  # âœ… UNCHANGED - Documentation
```

**Structure Decision**: Single project (backend CLI) - preserves existing structure while adding UI layer. Service layer remains unchanged and MCP-ready for future phases.

## Complexity Tracking

> **Constitution Check: ALL GATES PASSED** âœ…
> No violations requiring justification. Implementation follows established patterns.

**Complexity Assessment**: LOW
- **Business Logic**: 0 changes (preserved)
- **New Code**: ~200 lines (UI layer only)
- **Modified Code**: ~110 lines (cli.py, utils.py, main.py)
- **Removed Code**: ~200 lines (old command parser)
- **Net Impact**: ~110 lines added, significant UX improvement

**Risk Level**: LOW
- All existing functionality preserved
- Service layer unchanged
- Comprehensive test coverage planned
- Clear rollback path (revert to command parser)
